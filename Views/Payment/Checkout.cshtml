@model FliesProject.Models.Entities.Course
@{
    ViewData["Title"] = "Thanh toán khóa học";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Xác nhận thanh toán</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex mb-4">
                        <img src="@(string.IsNullOrEmpty(Model.CoursesPicture) ? "https://via.placeholder.com/150" : Model.CoursesPicture)" alt="@Model.Title"
                             class="img-thumbnail" style="width: 150px; height: 150px; object-fit: cover;">
                        <div class="ms-4">
                            <h4>@Model.Title</h4>
                            <p class="text-muted">@(string.IsNullOrEmpty(Model.Description) ? "Không có mô tả" : Model.Description.Length > 100 ? Model.Description.Substring(0, 100) + "..." : Model.Description)</p>
                            <p class="text-danger fw-bold">@Model.Price.ToString() VNĐ</p>
                        </div>
                    </div>
                    <hr />
                    <h5>Thông tin thanh toán</h5>
                    <p>Bạn sẽ được chuyển đến cổng thanh toán VNPay để hoàn tất giao dịch.</p>
                    <p>Sau khi thanh toán thành công, bạn sẽ ngay lập tức được đăng ký vào khóa học này.</p>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Lưu ý: Đây là giao dịch dùng VNPay Sandbox, không thực hiện thanh toán thật.
                    </div>

                    <form asp-action="ProcessPayment" asp-controller="Payment" method="post">
                        <input type="hidden" name="courseId" value="@Model.CourseId" />
                        @Html.AntiForgeryToken()
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a asp-action="CourseDescribe" asp-controller="Course" asp-route-id="@Model.CourseId" class="btn btn-secondary">Hủy</a>
                            <button type="submit" class="btn btn-primary">Tiếp tục thanh toán</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">Tóm tắt đơn hàng</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <span>Giá khóa học:</span>
                        <span>@Model.Price.ToString() VNĐ</span>
                    </div>
                    <hr />
                    <div class="d-flex justify-content-between fw-bold">
                        <span>Tổng thanh toán:</span>
                        <span class="text-danger">@Model.Price.ToString() VNĐ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Hiển thị thông báo nếu có
        $(document).ready(function () {
            var errorMessage = '@TempData["ErrorMessage"]';
            if (errorMessage && errorMessage !== '') {
                toastr.error(errorMessage);
            }
        });
    </script>
}
